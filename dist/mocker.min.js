!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.Mocker=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){module.exports=require("./lib/mocker")},{"./lib/mocker":2}],2:[function(require,module,exports){var utils=require("./utils");var Route=require("./route");var send=require("./send");function Mocker(){this.routes={get:[],post:[],put:[],"delete":[],"*":[]};this.settings={"case sensitive routing":false,"strict routing":false,"json replacer":undefined,"json spaces":undefined}}module.exports=Mocker;["post","put","delete"].forEach(function(verb){Mocker.prototype[verb]=addRoute(verb)});Mocker.prototype.get=function(){if(arguments.length===1)return this.settings[arguments[0]];else return addRoute("get").apply(this,Array.prototype.slice.call(arguments,0))};Mocker.prototype.set=function(key,value){this.settings[key]=value};Mocker.prototype.sync=function(){var mocker=this;return function sync(method,model,options){var type=utils.methodMap[method];var params={type:type,dataType:"json"};if(!options.url)params.url=utils.getURL(model)||utils.urlError();if(options.data==null&&model&&(method==="create"||method==="update"||method==="patch")){params.contentType="application/json";params.data=JSON.stringify(options.attrs||model.toJSON(options))}var routes=findRoute(mocker,type,options.url||params.url);return send(mocker,routes,params).then(function(data){console.log("calling success",options.success,data);if(options.success)options.success.call(model,data)},function(err){console.log(err);if(options.error)options.error.call(model,err);throw new Error(err)})}};function addRoute(verb){return function(path,fn){this.routes[verb].push(new Route(verb,path,fn,{sensitive:this.settings["case sensitive routing"],strict:this.settings["strict routing"]}))}}function findRoute(mocker,verb,path){var routes=mocker.routes[verb];var matchedRoutes=routes.reduce(function(matching,route){if(route.match(path))matching.push(route);return matching},[]);return matchedRoutes}},{"./route":5,"./send":6,"./utils":7}],3:[function(require,module,exports){function Request(mocker,route,params){this.get=this.header=this.range;this.accepts=this.acceptsEncoding=this.acceptsCharset=this.acceptsLanguage=this.is=noop;this.accepted=this.acceptedEncodings=this.acceptedCharsets=this.acceptedLanguages=[];this.protocol=this.ip=this.ips=this.auth="";this.fresh=this.stale=this.xhr=false;this.subdomains=[];this.path=this.host="";this.query={};this.params=route.params;this.body=JSON.stringify(params||"{}")}module.exports=Request;function noop(){}},{}],4:[function(require,module,exports){var utils=require("./utils");function Response(mocker,callback){this.charset="";this.statusCode=200;this.app=mocker;this.end=callback}module.exports=Response;Response.prototype={send:function(){var body;if(typeof arguments[0]==="number"){this.status(arguments[0]);body=arguments[1]}else{body=arguments[0]}if(!body)body=utils.STATUS_CODES[this.statusCode];console.log(body);this.end(body);return this},json:function(){var data;if(arguments.length===2){this.status(arguments[0]);data=arguments[1]}else{data=arguments[0]}var app=this.app;var replacer=app.get("json replacer");var spaces=app.get("json spaces");var body=JSON.stringify(data,replacer,spaces);return this.send(body)},jsonp:function(){throw new Error("res.jsonp not yet supported")},status:function(code){this.statusCode=code;return this},set:function(field,value){},get:function(field){},cookie:function(name,value,options){},clearCookie:function(name,options){},redirect:function(status,url){},location:function(){}}},{"./utils":7}],5:[function(require,module,exports){var utils=require("./utils");function Route(method,path,callback,options){this.path=path;this.method=method;this.callback=callback;this.regexp=utils.pathRegexp(path,this.keys=[],options.sensitive,options.strict)}module.exports=Route;Route.prototype.match=function(path){var keys=this.keys;var params=this.params=[];var m=this.regexp.exec(path);if(!m)return false;for(var i=1,len=m.length;i<len;++i){var key=keys[i-1];try{var val="string"==typeof m[i]?decodeURIComponent(m[i]):m[i]}catch(e){var err=new Error("Failed to decode param '"+m[i]+"'");err.status=400;throw err}if(key)params[key.name]=val;else params.push(val)}return true}},{"./utils":7}],6:[function(require,module,exports){var when=require("when");var Request=require("./request");var Response=require("./response");function send(mocker,routes,params){var deferred=when.defer();var route=routes[0];var req,res;if(route){req=new Request(mocker,route,params);res=new Response(mocker,success);route.callback(req,res)}else{deferred.reject()}function success(message){console.log(res.statusCode,message);if(res.statusCode!==200)deferred.reject(message);else deferred.resolve(message)}return deferred.promise}module.exports=send},{"./request":3,"./response":4,when:9}],7:[function(require,module,exports){var methodMap={read:"get",create:"post",update:"put","delete":"delete"};exports.methodMap=methodMap;function urlError(){throw new Error('A "url" property or function must be specified')}exports.urlError=urlError;function getURL(object){return typeof object.url==="function"?object.url():object.url}exports.getURL=getURL;function pathRegexp(path,keys,sensitive,strict){if(toString.call(path)=="[object RegExp]")return path;if(Array.isArray(path))path="("+path.join("|")+")";path=path.concat(strict?"":"/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?(\*)?/g,function(_,slash,format,key,capture,optional,star){keys.push({name:key,optional:!!optional});slash=slash||"";return""+(optional?"":slash)+"(?:"+(optional?slash:"")+(format||"")+(capture||(format&&"([^/.]+?)"||"([^/]+?)"))+")"+(optional||"")+(star?"(/*)?":"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)");return new RegExp("^"+path+"$",sensitive?"":"i")}exports.pathRegexp=pathRegexp;var STATUS_CODES=exports.STATUS_CODES={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Time-out",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Large",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Time-out",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"}},{}],8:[function(require,module,exports){var process=module.exports={};process.nextTick=function(){var canSetImmediate=typeof window!=="undefined"&&window.setImmediate;var canPost=typeof window!=="undefined"&&window.postMessage&&window.addEventListener;if(canSetImmediate){return function(f){return window.setImmediate(f)}}if(canPost){var queue=[];window.addEventListener("message",function(ev){if(ev.source===window&&ev.data==="process-tick"){ev.stopPropagation();if(queue.length>0){var fn=queue.shift();fn()}}},true);return function nextTick(fn){queue.push(fn);window.postMessage("process-tick","*")}}return function nextTick(fn){setTimeout(fn,0)}}();process.title="browser";process.browser=true;process.env={};process.argv=[];process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")}},{}],9:[function(require,module,exports){var process=require("__browserify_process");(function(define){"use strict";define(function(require){when.promise=promise;when.resolve=resolve;when.reject=reject;when.defer=defer;when.join=join;when.all=all;when.map=map;when.reduce=reduce;when.settle=settle;when.any=any;when.some=some;when.isPromise=isPromiseLike;when.isPromiseLike=isPromiseLike;function when(promiseOrValue,onFulfilled,onRejected,onProgress){return cast(promiseOrValue).then(onFulfilled,onRejected,onProgress)}function promise(resolver){return new Promise(resolver,monitorApi.PromiseStatus&&monitorApi.PromiseStatus())}function Promise(resolver,status){var self,value,consumers=[];self=this;this._status=status;this.inspect=inspect;this._when=_when;try{resolver(promiseResolve,promiseReject,promiseNotify)}catch(e){promiseReject(e)}function inspect(){return value?value.inspect():toPendingState()}function _when(resolve,notify,onFulfilled,onRejected,onProgress){consumers?consumers.push(deliver):enqueue(function(){deliver(value)});function deliver(p){p._when(resolve,notify,onFulfilled,onRejected,onProgress)}}function promiseResolve(val){if(!consumers){return}var queue=consumers;consumers=undef;enqueue(function(){value=coerce(self,val);if(status){updateStatus(value,status)}runHandlers(queue,value)})}function promiseReject(reason){promiseResolve(new RejectedPromise(reason))}function promiseNotify(update){if(consumers){var queue=consumers;enqueue(function(){runHandlers(queue,new ProgressingPromise(update))})}}}promisePrototype=Promise.prototype;promisePrototype.then=function(onFulfilled,onRejected,onProgress){var self=this;return new Promise(function(resolve,reject,notify){self._when(resolve,notify,onFulfilled,onRejected,onProgress)},this._status&&this._status.observed())};promisePrototype["catch"]=promisePrototype.otherwise=function(onRejected){return this.then(undef,onRejected)};promisePrototype["finally"]=promisePrototype.ensure=function(onFulfilledOrRejected){return typeof onFulfilledOrRejected==="function"?this.then(injectHandler,injectHandler)["yield"](this):this;function injectHandler(){return resolve(onFulfilledOrRejected())}};promisePrototype.done=function(handleResult,handleError){this.then(handleResult,handleError)["catch"](crash)};promisePrototype["yield"]=function(value){return this.then(function(){return value})};promisePrototype.tap=function(onFulfilledSideEffect){return this.then(onFulfilledSideEffect)["yield"](this)};promisePrototype.spread=function(onFulfilled){return this.then(function(array){return all(array,function(array){return onFulfilled.apply(undef,array)})})};promisePrototype.always=function(onFulfilledOrRejected,onProgress){return this.then(onFulfilledOrRejected,onFulfilledOrRejected,onProgress)};function cast(x){return x instanceof Promise?x:resolve(x)}function resolve(value){return promise(function(resolve){resolve(value)})}function reject(promiseOrValue){return when(promiseOrValue,function(e){return new RejectedPromise(e)})}function defer(){var deferred,pending,resolved;deferred={promise:undef,resolve:undef,reject:undef,notify:undef,resolver:{resolve:undef,reject:undef,notify:undef}};deferred.promise=pending=promise(makeDeferred);return deferred;function makeDeferred(resolvePending,rejectPending,notifyPending){deferred.resolve=deferred.resolver.resolve=function(value){if(resolved){return resolve(value)}resolved=true;resolvePending(value);return pending};deferred.reject=deferred.resolver.reject=function(reason){if(resolved){return resolve(new RejectedPromise(reason))}resolved=true;rejectPending(reason);return pending};deferred.notify=deferred.resolver.notify=function(update){notifyPending(update);return update}}}function runHandlers(queue,value){for(var i=0;i<queue.length;i++){queue[i](value)}}function coerce(self,x){if(x===self){return new RejectedPromise(new TypeError)}if(x instanceof Promise){return x}try{var untrustedThen=x===Object(x)&&x.then;return typeof untrustedThen==="function"?assimilate(untrustedThen,x):new FulfilledPromise(x)}catch(e){return new RejectedPromise(e)}}function assimilate(untrustedThen,x){return promise(function(resolve,reject){fcall(untrustedThen,x,resolve,reject)})}makePromisePrototype=Object.create||function(o){function PromisePrototype(){}PromisePrototype.prototype=o;return new PromisePrototype};function FulfilledPromise(value){this.value=value}FulfilledPromise.prototype=makePromisePrototype(promisePrototype);FulfilledPromise.prototype.inspect=function(){return toFulfilledState(this.value)};FulfilledPromise.prototype._when=function(resolve,_,onFulfilled){try{resolve(typeof onFulfilled==="function"?onFulfilled(this.value):this.value)}catch(e){resolve(new RejectedPromise(e))}};function RejectedPromise(reason){this.value=reason}RejectedPromise.prototype=makePromisePrototype(promisePrototype);RejectedPromise.prototype.inspect=function(){return toRejectedState(this.value)};RejectedPromise.prototype._when=function(resolve,_,__,onRejected){try{resolve(typeof onRejected==="function"?onRejected(this.value):this)}catch(e){resolve(new RejectedPromise(e))}};function ProgressingPromise(value){this.value=value}ProgressingPromise.prototype=makePromisePrototype(promisePrototype);ProgressingPromise.prototype._when=function(_,notify,f,r,u){try{notify(typeof u==="function"?u(this.value):this.value)}catch(e){notify(e)}};function updateStatus(value,status){value.then(statusFulfilled,statusRejected);function statusFulfilled(){status.fulfilled()}function statusRejected(r){status.rejected(r)}}function isPromiseLike(x){return x&&typeof x.then==="function"}function some(promisesOrValues,howMany,onFulfilled,onRejected,onProgress){return when(promisesOrValues,function(promisesOrValues){return promise(resolveSome).then(onFulfilled,onRejected,onProgress);function resolveSome(resolve,reject,notify){var toResolve,toReject,values,reasons,fulfillOne,rejectOne,len,i;len=promisesOrValues.length>>>0;toResolve=Math.max(0,Math.min(howMany,len));values=[];toReject=len-toResolve+1;reasons=[];if(!toResolve){resolve(values)}else{rejectOne=function(reason){reasons.push(reason);if(!--toReject){fulfillOne=rejectOne=identity;reject(reasons)}};fulfillOne=function(val){values.push(val);if(!--toResolve){fulfillOne=rejectOne=identity;resolve(values)}};for(i=0;i<len;++i){if(i in promisesOrValues){when(promisesOrValues[i],fulfiller,rejecter,notify)}}}function rejecter(reason){rejectOne(reason)}function fulfiller(val){fulfillOne(val)}}})}function any(promisesOrValues,onFulfilled,onRejected,onProgress){function unwrapSingleResult(val){return onFulfilled?onFulfilled(val[0]):val[0]}return some(promisesOrValues,1,unwrapSingleResult,onRejected,onProgress)}function all(promisesOrValues,onFulfilled,onRejected,onProgress){return _map(promisesOrValues,identity).then(onFulfilled,onRejected,onProgress)}function join(){return _map(arguments,identity)}function settle(array){return _map(array,toFulfilledState,toRejectedState)}function map(array,mapFunc){return _map(array,mapFunc)}function _map(array,mapFunc,fallback){return when(array,function(array){return new Promise(resolveMap);function resolveMap(resolve,reject,notify){var results,len,toResolve,i;toResolve=len=array.length>>>0;results=[];if(!toResolve){resolve(results);return}for(i=0;i<len;i++){if(i in array){resolveOne(array[i],i)}else{--toResolve}}function resolveOne(item,i){when(item,mapFunc,fallback).then(function(mapped){results[i]=mapped;if(!--toResolve){resolve(results)}},reject,notify)}}})}function reduce(promise,reduceFunc){var args=fcall(slice,arguments,1);return when(promise,function(array){var total;total=array.length;args[0]=function(current,val,i){return when(current,function(c){return when(val,function(value){return reduceFunc(c,value,i,total)})})};return reduceArray.apply(array,args)})}function toFulfilledState(x){return{state:"fulfilled",value:x}}function toRejectedState(x){return{state:"rejected",reason:x}}function toPendingState(){return{state:"pending"}}var promisePrototype,makePromisePrototype,reduceArray,slice,fcall,nextTick,handlerQueue,funcProto,call,arrayProto,monitorApi,capturedSetTimeout,cjsRequire,MutationObs,undef;cjsRequire=require;handlerQueue=[];function enqueue(task){if(handlerQueue.push(task)===1){nextTick(drainQueue)}}function drainQueue(){runHandlers(handlerQueue);handlerQueue=[]}monitorApi=typeof console!=="undefined"?console:when;if(typeof process==="object"&&process.nextTick){nextTick=process.nextTick}else if(MutationObs=typeof MutationObserver==="function"&&MutationObserver||typeof WebKitMutationObserver==="function"&&WebKitMutationObserver){nextTick=function(document,MutationObserver,drainQueue){var el=document.createElement("div");new MutationObserver(drainQueue).observe(el,{attributes:true});return function(){el.setAttribute("x","x")}}(document,MutationObs,drainQueue)}else{try{nextTick=cjsRequire("vertx").runOnLoop||cjsRequire("vertx").runOnContext}catch(ignore){capturedSetTimeout=setTimeout;nextTick=function(t){capturedSetTimeout(t,0)}}}funcProto=Function.prototype;call=funcProto.call;fcall=funcProto.bind?call.bind(call):function(f,context){return f.apply(context,slice.call(arguments,2))};arrayProto=[];slice=arrayProto.slice;reduceArray=arrayProto.reduce||function(reduceFunc){var arr,args,reduced,len,i;i=0;arr=Object(this);len=arr.length>>>0;args=arguments;if(args.length<=1){for(;;){if(i in arr){reduced=arr[i++];break}if(++i>=len){throw new TypeError}}}else{reduced=args[1]}for(;i<len;++i){if(i in arr){reduced=reduceFunc(reduced,arr[i],i,arr)}}return reduced};function identity(x){return x}function crash(fatalError){if(typeof monitorApi.reportUnhandled==="function"){monitorApi.reportUnhandled()}else{enqueue(function(){throw fatalError})}throw fatalError}return when})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{__browserify_process:8}]},{},[1])(1)});